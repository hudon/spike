sudo apt-get install virtualbox

VBoxManage createvm --name spike-vm --register
VBoxManage modifyvm spike-vm --memory 2048 --nic1 nat --natpf1 "ssh,tcp,,3123,,22"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port9000,tcp,,9000,,9000"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8000,tcp,,8000,,8000"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8001,tcp,,8001,,8001"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8002,tcp,,8002,,8002"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8003,tcp,,8003,,8003"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8004,tcp,,8004,,8004"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8005,tcp,,8005,,8005"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8006,tcp,,8006,,8006"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8007,tcp,,8007,,8007"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8008,tcp,,8008,,8008"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8009,tcp,,8009,,8009"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8010,tcp,,8010,,8010"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8011,tcp,,8011,,8011"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port8012,tcp,,8012,,8012"

VBoxManage modifyvm spike-vm --natpf1 "udp-port9000,udp,,9000,,9000"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8000,udp,,8000,,8000"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8001,udp,,8001,,8001"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8002,udp,,8002,,8002"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8003,udp,,8003,,8003"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8004,udp,,8004,,8004"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8005,udp,,8005,,8005"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8006,udp,,8006,,8006"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8007,udp,,8007,,8007"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8008,udp,,8008,,8008"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8009,udp,,8009,,8009"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8010,udp,,8010,,8010"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8011,udp,,8011,,8011"
VBoxManage modifyvm spike-vm --natpf1 "udp-port8012,udp,,8012,,8012"

VBoxManage modifyvm spike-vm --natpf1 "tcp-port50000,tcp,,50000,,50000"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50001,tcp,,50001,,50001"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50002,tcp,,50002,,50002"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50003,tcp,,50003,,50003"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50004,tcp,,50004,,50004"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50005,tcp,,50005,,50005"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50006,tcp,,50006,,50006"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50007,tcp,,50007,,50007"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50008,tcp,,50008,,50008"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50009,tcp,,50009,,50009"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50010,tcp,,50010,,50010"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50011,tcp,,50011,,50011"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50012,tcp,,50012,,50012"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50013,tcp,,50013,,50013"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50014,tcp,,50014,,50014"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50015,tcp,,50015,,50015"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50016,tcp,,50016,,50016"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50017,tcp,,50017,,50017"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50018,tcp,,50018,,50018"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50019,tcp,,50019,,50019"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50020,tcp,,50020,,50020"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50021,tcp,,50021,,50021"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50022,tcp,,50022,,50022"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50023,tcp,,50023,,50023"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50024,tcp,,50024,,50024"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50025,tcp,,50025,,50025"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50026,tcp,,50026,,50026"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50027,tcp,,50027,,50027"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50028,tcp,,50028,,50028"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50029,tcp,,50029,,50029"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50030,tcp,,50030,,50030"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50031,tcp,,50031,,50031"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50032,tcp,,50032,,50032"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50033,tcp,,50033,,50033"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50034,tcp,,50034,,50034"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50035,tcp,,50035,,50035"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50036,tcp,,50036,,50036"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50037,tcp,,50037,,50037"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50038,tcp,,50038,,50038"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50039,tcp,,50039,,50039"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50040,tcp,,50040,,50040"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50041,tcp,,50041,,50041"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50042,tcp,,50042,,50042"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50043,tcp,,50043,,50043"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50044,tcp,,50044,,50044"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50045,tcp,,50045,,50045"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50046,tcp,,50046,,50046"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50047,tcp,,50047,,50047"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50048,tcp,,50048,,50048"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50049,tcp,,50049,,50049"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50050,tcp,,50050,,50050"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50051,tcp,,50051,,50051"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50052,tcp,,50052,,50052"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50053,tcp,,50053,,50053"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50054,tcp,,50054,,50054"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50055,tcp,,50055,,50055"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50056,tcp,,50056,,50056"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50057,tcp,,50057,,50057"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50058,tcp,,50058,,50058"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50059,tcp,,50059,,50059"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50060,tcp,,50060,,50060"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50061,tcp,,50061,,50061"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50062,tcp,,50062,,50062"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50063,tcp,,50063,,50063"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50064,tcp,,50064,,50064"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50065,tcp,,50065,,50065"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50066,tcp,,50066,,50066"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50067,tcp,,50067,,50067"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50068,tcp,,50068,,50068"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50069,tcp,,50069,,50069"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50070,tcp,,50070,,50070"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50071,tcp,,50071,,50071"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50072,tcp,,50072,,50072"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50073,tcp,,50073,,50073"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50074,tcp,,50074,,50074"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50075,tcp,,50075,,50075"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50076,tcp,,50076,,50076"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50077,tcp,,50077,,50077"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50078,tcp,,50078,,50078"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50079,tcp,,50079,,50079"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50080,tcp,,50080,,50080"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50081,tcp,,50081,,50081"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50082,tcp,,50082,,50082"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50083,tcp,,50083,,50083"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50084,tcp,,50084,,50084"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50085,tcp,,50085,,50085"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50086,tcp,,50086,,50086"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50087,tcp,,50087,,50087"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50088,tcp,,50088,,50088"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50089,tcp,,50089,,50089"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50090,tcp,,50090,,50090"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50091,tcp,,50091,,50091"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50092,tcp,,50092,,50092"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50093,tcp,,50093,,50093"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50094,tcp,,50094,,50094"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50095,tcp,,50095,,50095"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50096,tcp,,50096,,50096"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50097,tcp,,50097,,50097"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50098,tcp,,50098,,50098"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50099,tcp,,50099,,50099"
VBoxManage modifyvm spike-vm --natpf1 "tcp-port50100,tcp,,50100,,50100"

VBoxManage storagectl spike-vm --name "IDE Controller" --add ide
VBoxManage storageattach spike-vm --storagectl "IDE Controller" --port 1 --device 0 --type dvddrive --medium /home/spike/archlinux-2013.11.01-dual.iso

vboxmanage startvm spike-vm --type headless 

#  Give the vm some time to get to the boot menu
sleep 5
#  Press enter on the boot menu
VBoxManage controlvm spike-vm keyboardputscancode 1c 9c

#  Give the vm some time boot 
sleep 30

#  Type 'systemctl start sshd'
VBoxManage controlvm spike-vm keyboardputscancode 1f 9f 15 95 1f 9f 14 94 12 92 32 b2 2e ae 14 94 26 a6 39 b9 1f 9f 14 94 1e 9e 13 93 14 94 39 b9 1f 9f 1f 9f 23 a3 20 a0
sleep 1
#  Enter 
VBoxManage controlvm spike-vm keyboardputscancode 1c 9c
#  Wait for sshd to startup
sleep 4
#  Type 'passwd'
VBoxManage controlvm spike-vm keyboardputscancode 19 99 1e 9e 1f 9f 1f 9f 11 91 20 a0
sleep 1
#  Enter 
VBoxManage controlvm spike-vm keyboardputscancode 1c 9c
#  Don't type too fast
sleep 1
#  Type 'spike2014'
VBoxManage controlvm spike-vm keyboardputscancode 1f 9f 19 99 17 97 25 a5 12 92 03 83 0b 8b 02 82 05 85
sleep 1
#  Enter 
VBoxManage controlvm spike-vm keyboardputscancode 1c 9c
#  Don't type too fast
sleep 1
#  Type 'spike2014'
VBoxManage controlvm spike-vm keyboardputscancode 1f 9f 19 99 17 97 25 a5 12 92 03 83 0b 8b 02 82 05 85
sleep 1
#  Enter 
VBoxManage controlvm spike-vm keyboardputscancode 1c 9c

#  Delete the known host record for if we previously set up the virtual machine
ssh-keygen -f "/home/spike/.ssh/known_hosts" -R [localhost]:3123

ssh root@localhost -p 3123 -o StrictHostKeyChecking=no
pacman -Syy --noconfirm
pacman -S base-devel --noconfirm
pacman -S python2 --noconfirm
pacman -S python2-numpy --noconfirm
pacman -S python2-scipy --noconfirm
pacman -S git --noconfirm

git clone https://github.com/python-quantities/python-quantities.git
cd python-quantities
python2 setup.py install
cd ..

#  Install theano
wget https://aur.archlinux.org/packages/py/python2-theano/python2-theano.tar.gz
tar -xzf python2-theano.tar.gz
cd python2-theano
makepkg -s --asroot --noconfirm
pacman -U --noconfirm python2-theano-0.6.0rc3-1-any.pkg.tar.xz
cd ..

#  Install zeromq
wget http://download.zeromq.org/zeromq-2.2.0.tar.gz && tar xf zeromq-2.2.0.tar.gz && cd zeromq-2.2.0 && ./configure && make && sudo make install && cd ..
pacman -S python2-pyzmq --noconfirm

git clone git://github.com/Hudon/spike.git
#  Make the ephemeral port range smaller so we can do NAT
echo "50000 50100" > /proc/sys/net/ipv4/ip_local_port_range


